■株式会社電子辞典の HD 辞典シリーズのファイル形式

4096バイト毎に LZSS で圧縮
まとめて圧縮するデータの塊をチャンクと呼ぶ
リトルエンディアン(LE)
本文は UTF-16 (LE)
ヘッダ、オフセット部、チャンク部で構成

■ヘッダ

0x50バイト

  位置 (バイト数)
  -----------------
  0x00 (4) 'BODY' など
  0x16 (4)
  0x1a (4) チャンク部開始位置(ファイルの先頭から)
  0x1e (4) チャンク部のサイズ
  0x40 (4) 圧縮前データサイズ

ファイルサイズ = チャンク部開始位置 + チャンク部のサイズ
チャンク数 = (チャンク部開始位置 - 0x50) / 4

■オフセット部

(4 * チャンク数) バイト
各チャンクの開始位置(チャンク部開始位置から)の列
4バイト、LE

■チャンク部

4096バイト毎に LZSS で圧縮

まず、1ビットのフラグ。
フラグが 1 のときは続く8ビットが文字。
フラグが 0 のときは、続く8ビットで位置を5ビットで一致長。
一致長には2を加える。


■解読法

まずは1チャンク1ファイルに分割します。
つぎに、各ファイルの先頭8バイトを2進ダンプすると、

$ for i in kbody/*;do head -c 8 $i|bbd;echo;done | head
11110100 01000000 00000000 01000000 10010001 01111110 00100000 00100000 
10100101 11001100 00110001 00110011 00001100 01011110 00100110 10111111 
11001001 01001000 01100001 00111111 11111010 10010111 11100011 01111111 
10000110 11001100 00100100 01111111 10001001 00010111 11100010 00000011 
10010000 01000000 00111111 01010101 11101011 01001101 11001010 11011101 
10011010 01111110 00111010 10110101 00101010 11110110 00101010 11010111 
11111000 01001100 00100100 10110010 00001010 10001111 11100010 00100111 
11010010 01001100 00110111 10110011 00001000 00010100 11000010 01000111 
10101101 11001100 00101100 11010011 00001001 11111101 10001110 10110011 
10001000 01001100 00110010 01111001 01011100 11110110 00101011 00010101 
A         A         A         A

このように、0, 9, 18, 27, ...ビット目に縦に1が並びます。
では逆に27ビット目が 1 ではなく 0 で、
18ビット目が 1 なブロックは、

$ for i in kbody/* rbody/*;do head -c 8 $i|bbd;echo;done | egrep '^.{30}0' | egrep '^.{20}1'|head
11011100 01001100 00111001 00000000 00100000 11000011 01100110 00010010 
11110010 01001100 00110101 11100000 00100000 11111011 11100110 00011111 
10110010 11000000 00101110 01100000 00100000 11001000 00100000 00010011 
10111011 11000000 00101101 11100000 00100000 11011001 00100000 00010010 
10110000 11000000 00101100 11100000 00100000 11011100 10100000 00010110 
10110000 11000000 00101101 10000000 00100000 11001000 00100000 00010011 
10110111 11000000 00101101 11000000 00100000 11011001 01100000 00010010 
10111010 01000000 00101100 10100000 00100000 01111111 11100110 10011111 
10110111 11000000 00101100 10100000 00100000 01111111 11100110 10011111 
10110110 11000000 00101100 10100000 00100000 01111111 11100110 10011111 
                    A         A               A         A         A

このようになります。
